<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mic Probe</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé§</text></svg>">
  <!-- Google Fonts: Inter (UI) + JetBrains Mono (monospace) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <svg class="sidebar-logo" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 1C10.34 1 9 2.34 9 4V12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12V4C15 2.34 13.66 1 12 1Z"/>
          <path d="M19 11H21C21 14.53 18.39 17.44 15 17.93V21H9V17.93C5.61 17.44 3 14.53 3 11H5C5 14.31 7.69 17 11 17H13C16.31 17 19 14.31 19 11Z" opacity="0.6"/>
        </svg>
        <span class="sidebar-title">Mic Probe</span>
      </div>

      <nav class="sidebar-nav">
        <!-- Sesli Gorusme Kategorisi -->
        <div class="nav-section">
          <span class="nav-section-title">üìû Sesli Gorusme</span>
          <button class="nav-item nav-item-sub active" data-profile="discord">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
            <span>Discord</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="zoom">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.585 6.836A1.414 1.414 0 0 0 3.172 8.25v7.5a1.413 1.413 0 0 0 1.413 1.414h9.344a1.413 1.413 0 0 0 1.414-1.414v-2.197l3.727 2.484a.944.944 0 0 0 .943.007.938.938 0 0 0 .475-.816V8.777a.938.938 0 0 0-.475-.816.944.944 0 0 0-.943.007l-3.727 2.484V8.25a1.414 1.414 0 0 0-1.414-1.414z"/></svg>
            <span>Zoom / Meet / Teams</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="whatsapp-call">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            <span>WhatsApp Web Arama</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="telegram-call">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
            <span>Telegram Web Arama</span>
          </button>
        </div>

        <!-- Kayit Kategorisi -->
        <div class="nav-section">
          <span class="nav-section-title">üéôÔ∏è Kayit</span>
          <button class="nav-item nav-item-sub" data-profile="whatsapp-voice">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            <span>WhatsApp Sesli Mesaj</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="telegram-voice">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
            <span>Telegram Sesli Mesaj</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="legacy">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
            <span>Eski Web Kayit</span>
          </button>
          <button class="nav-item nav-item-sub" data-profile="mictest">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1 1.93c-3.94-.49-7-3.85-7-7.93h2c0 3.31 2.69 6 6 6s6-2.69 6-6h2c0 4.08-3.06 7.44-7 7.93V20h4v2H8v-2h4v-4.07z"/></svg>
            <span>Ham Kayit</span>
          </button>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="sidebar-status" id="sidebarStatus">
          <span class="status-indicator"></span>
          <span class="status-text">Hazir</span>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="content-container">
        <!-- Header -->
        <header class="page-header">
          <div class="header-left">
            <h1 id="pageTitle">Discord Voice Test</h1>
            <p id="pageSubtitle">WebRTC Loopback + Opus 64kbps</p>
          </div>
          <div class="header-right">
            <span id="statusBadge" class="status status-idle"><span class="status-dot"></span>Hazir</span>
          </div>
        </header>

        <!-- Two Column Layout: Ana icerik + Log paneli -->
        <div class="content-grid">
          <!-- Sol - Ana Kontroller -->
          <div class="content-column">
            <!-- Ust kisim: Kontroller ve VU Meter yan yana -->
            <div class="controls-row">
              <!-- Mikrofon + Butonlar -->
              <div class="panel panel-controls">
                <div class="panel-header">
                  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1 1.93c-3.94-.49-7-3.85-7-7.93h2c0 3.31 2.69 6 6 6s6-2.69 6-6h2c0 4.08-3.06 7.44-7 7.93V20h4v2H8v-2h4v-4.07z"/></svg>
                  <span>Kontroller</span>
                </div>
                <div class="panel-body">
                  <!-- Mikrofon Secici -->
                  <div class="mic-selector-row">
                    <select id="micSelector" class="mic-dropdown">
                      <option value="">Varsayilan mikrofon</option>
                    </select>
                    <button id="refreshMics" class="btn-icon" title="Mikrofon listesini yenile">
                      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                  </div>

                  <!-- Butonlar -->
                  <div class="button-row">
                    <button id="recordToggle" class="btn btn-record">
                      <svg class="icon-circle" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"/></svg>
                      <svg class="icon-square" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                      <span class="btn-text">Kayit</span>
                    </button>
                    <button id="monitorToggle" class="btn btn-monitor">
                      <svg class="icon-play" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
                      <svg class="icon-stop" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                      <span class="btn-text">Monitor</span>
                    </button>
                  </div>

                  <!-- Recording Timer -->
                  <div id="recordingTimer" class="recording-timer" style="display: none;">0:00</div>

                  <!-- Hazirlanƒ±yor Overlay -->
                  <div id="preparingOverlay" class="preparing-overlay" style="display: none;">
                    <span class="preparing-spinner"></span>
                    <span class="preparing-text">Hazƒ±rlanƒ±yor...</span>
                  </div>

                  <!-- VU Meter (Local - Mikrofon) -->
                  <div class="vu-section">
                    <div class="vu-label">
                      <span id="signalDot" class="signal-dot"></span>
                      <span>Local (Mikrofon)</span>
                    </div>
                    <div class="vu-meter">
                      <div id="vuMeterBar" class="vu-meter-bar"></div>
                      <div id="vuMeterPeak" class="vu-meter-peak"></div>
                    </div>
                  </div>

                  <!-- Remote VU Meter (Codec Sonrasi - Loopback'te gorunur) -->
                  <div id="remoteVuContainer" class="vu-section">
                    <div class="vu-label">
                      <span class="signal-dot remote-dot"></span>
                      <span>Remote (Codec Sonrasi)</span>
                    </div>
                    <div class="vu-meter">
                      <div id="remoteVuBar" class="vu-meter-bar remote-bar"></div>
                      <div id="remoteVuPeak" class="vu-meter-peak"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Kayit Oynatici -->
              <div class="panel panel-player">
                <div class="panel-header">
                  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                  <span>Kayit Oynatici</span>
                </div>
                <div class="panel-body">
                  <div id="recordingPlayer" class="recording-player">
                    <div class="player-controls">
                      <button id="playBtn" class="btn-play">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                      </button>
                      <div class="player-info">
                        <div id="playerFilename" class="player-filename">-</div>
                        <div id="playerMeta" class="player-meta">-</div>
                      </div>
                    </div>
                    <div class="player-progress-row">
                      <div class="progress-bar" id="progressBar">
                        <div id="progressFill" class="progress-fill"></div>
                      </div>
                      <div id="playerTime" class="player-time">0:00 / 0:00</div>
                    </div>
                    <div class="player-actions">
                      <a id="downloadBtn" class="btn-download" href="#" download>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        Indir
                      </a>
                    </div>
                  </div>
                  <p id="noRecording" class="empty-state">Henuz kayit yok</p>
                </div>
              </div>
            </div>

            <!-- Ozel Ayarlar Panel (Profil bazli) -->
            <div class="panel panel-custom-settings" id="customSettingsPanel">
              <div class="panel-header custom-settings-toggle" id="customSettingsToggle">
                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                <span>Ozel Ayarlar</span>
                <svg class="toggle-chevron" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5z"/></svg>
              </div>
              <div class="panel-body custom-settings-content collapsed" id="customSettingsContent">
                <p class="custom-settings-hint">Bu profil icin duzenleme yapabilecekleriniz:</p>
                <div class="custom-settings-grid" id="customSettingsGrid">
                  <!-- Dinamik icerik JS ile doldurulacak -->
                </div>
              </div>
            </div>

            <!-- Ses Durumu Panel - 3 Bolum -->
            <div id="deviceInfoPanel" class="panel device-info-panel">
              <div class="panel-header">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/></svg>
                <span>Ses Durumu</span>
              </div>
              <div class="panel-body audio-status-body">
                <!-- Cihaz Bolumu -->
                <div class="audio-status-section">
                  <div class="audio-status-title">Cihaz</div>
                  <div class="audio-status-grid">
                    <div class="audio-status-item">
                      <span class="audio-status-label">Mikrofon</span>
                      <span id="infoMicName" class="audio-status-value">--</span>
                    </div>
                    <div class="audio-status-item">
                      <span class="audio-status-label">Kanal</span>
                      <span id="infoChannels" class="audio-status-value">--</span>
                    </div>
                  </div>
                </div>
                <!-- Codec Bolumu -->
                <div class="audio-status-section">
                  <div class="audio-status-title">Codec</div>
                  <div class="audio-status-grid">
                    <div class="audio-status-item">
                      <span class="audio-status-label">Hedef Bitrate</span>
                      <span id="infoTargetBitrate" class="audio-status-value">--</span>
                    </div>
                    <div class="audio-status-item">
                      <span class="audio-status-label">Gercek Bitrate</span>
                      <span id="infoActualBitrate" class="audio-status-value">--</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sag - Log Paneli -->
          <div class="content-column">
            <div class="panel panel-log">
              <div class="panel-header">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/></svg>
                <span>Konsol</span>
                <button class="btn-copy" id="copyLogsBtn" onclick="copyAllLogs()" title="Tum loglari kopyala">
                  <svg class="icon-copy" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  <svg class="icon-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </button>
                <button class="btn-clear" onclick="clearLog()">Temizle</button>
              </div>
              <div class="panel-body panel-body-log">
                <pre id="log"></pre>
              </div>
              <div class="panel-footer">
                <div class="filter-buttons">
                  <button class="btn-filter active" data-category="all" onclick="filterLogs('all')">Tumu</button>
                  <button class="btn-filter btn-filter-error" data-category="error" onclick="filterLogs('error')">Errors</button>
                  <button class="btn-filter" data-category="webaudio" onclick="filterLogs('webaudio')">WebAudio</button>
                  <button class="btn-filter" data-category="stream" onclick="filterLogs('stream')">Stream</button>
                  <button class="btn-filter" data-category="recorder" onclick="filterLogs('recorder')">Recorder</button>
                </div>
                <div class="export-buttons">
                  <button class="btn-export-small" onclick="exportLogs()" title="Tum loglari JSON olarak indir">Export</button>
                  <button class="btn-export-small" onclick="getLogStats()" title="Log istatistikleri">Stats</button>
                  <button class="btn-export-small" onclick="runSanityChecks()" title="Log mantik kontrolu">Sanity</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Gelismis Ayarlar Modal/Drawer -->
    <div id="settingsDrawer" class="settings-drawer">
      <div class="drawer-header">
        <h3>Gelismis Ayarlar</h3>
        <button class="btn-close-drawer" id="closeDrawer">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </div>
      <div class="drawer-body">
        <!-- Ses Isleme -->
        <div class="settings-section">
          <div class="settings-section-title">Ses Isleme</div>
          <div class="settings-grid">
            <label class="setting-item">
              <input id="ec" type="checkbox" checked>
              <span class="setting-label">Echo Cancellation</span>
            </label>
            <label class="setting-item">
              <input id="ns" type="checkbox" checked>
              <span class="setting-label">Noise Suppression</span>
            </label>
            <label class="setting-item">
              <input id="agc" type="checkbox" checked>
              <span class="setting-label">Auto Gain Control</span>
            </label>
          </div>

          <!-- Sample Rate -->
          <div id="sampleRateContainer" class="mode-container" data-setting="sampleRate">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
              <span>√ñrnekleme Hƒ±zƒ±</span>
            </div>
            <div class="segment-control" id="sampleRateSelector">
              <input type="radio" name="sampleRate" id="sr16" value="16000">
              <label for="sr16" class="segment-btn">16 kHz</label>

              <input type="radio" name="sampleRate" id="sr22" value="22050">
              <label for="sr22" class="segment-btn">22 kHz</label>

              <input type="radio" name="sampleRate" id="sr44" value="44100">
              <label for="sr44" class="segment-btn">44.1 kHz</label>

              <input type="radio" name="sampleRate" id="sr48" value="48000" checked>
              <label for="sr48" class="segment-btn">48 kHz</label>
            </div>
          </div>

          <!-- Channel Count -->
          <div id="channelCountContainer" class="mode-container" data-setting="channelCount">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.76 16.24l-1.41 1.41C4.78 16.1 4 14.05 4 12c0-2.05.78-4.1 2.34-5.66l1.41 1.41C6.59 8.93 6 10.46 6 12s.59 3.07 1.76 4.24zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm5.66 1.66l-1.41-1.41C17.41 15.07 18 13.54 18 12s-.59-3.07-1.76-4.24l1.41-1.41C19.22 7.9 20 9.95 20 12c0 2.05-.78 4.1-2.34 5.66z"/></svg>
              <span>Kanal Sayƒ±sƒ±</span>
            </div>
            <div class="segment-control" id="channelCountSelector">
              <input type="radio" name="channelCount" id="ch1" value="1" checked>
              <label for="ch1" class="segment-btn">Mono</label>

              <input type="radio" name="channelCount" id="ch2" value="2">
              <label for="ch2" class="segment-btn">Stereo</label>
            </div>
          </div>
        </div>

        <!-- Pipeline Ayarlari -->
        <div class="settings-section" id="pipelineSection">
          <div class="settings-section-title">Ses Isleme</div>

          <!-- NOT: WebAudio toggle kaldirildi - mode secimi WebAudio durumunu belirliyor -->
          <!-- Processing Mode -->
          <div id="processingModeContainer" class="mode-container" data-setting="mode">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
              <span>Islem Modu</span>
            </div>
            <div class="segment-control" id="processingModeSelector">
              <input type="radio" name="processingMode" id="modeDirect" value="direct">
              <label for="modeDirect" class="segment-btn">Direct</label>

              <input type="radio" name="processingMode" id="modeStandard" value="standard" checked>
              <label for="modeStandard" class="segment-btn">Standard</label>

              <input type="radio" name="processingMode" id="modeScript" value="scriptprocessor">
              <label for="modeScript" class="segment-btn">ScriptProcessor</label>

              <input type="radio" name="processingMode" id="modeWorklet" value="worklet">
              <label for="modeWorklet" class="segment-btn">Worklet</label>
            </div>
          </div>

          <!-- Buffer Size -->
          <div id="bufferSizeContainer" class="mode-container" data-setting="buffer">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/></svg>
              <span>Buffer Size</span>
            </div>
            <div class="segment-control" id="bufferSizeSelector">
              <input type="radio" name="bufferSize" id="buffer1024" value="1024">
              <label for="buffer1024" class="segment-btn">1024</label>

              <input type="radio" name="bufferSize" id="buffer2048" value="2048">
              <label for="buffer2048" class="segment-btn">2048</label>

              <input type="radio" name="bufferSize" id="buffer4096" value="4096" checked>
              <label for="buffer4096" class="segment-btn">4096</label>
            </div>
            <div class="buffer-info">
              <span class="info-text" id="bufferInfoText">4096 samples @ 48kHz = ~85ms latency</span>
            </div>
          </div>
        </div>

        <!-- WebRTC Ayarlari -->
        <div class="settings-section" id="webrtcSection">
          <div class="settings-section-title">WebRTC Simulasyonu</div>

          <!-- Loopback Toggle -->
          <div class="loopback-toggle-container" data-setting="loopback">
            <div class="toggle-info">
              <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c1.03.13 2 .45 2.87.93H13v-.93zM13 7h5.24c.25.31.48.65.68 1H13V7zm0 3h6.74c.08.33.15.66.19 1H13v-1zm0 9.93V19h2.87c-.87.48-1.84.8-2.87.93zM18.24 17H13v-1h5.92c-.2.35-.43.69-.68 1zm1.5-3H13v-1h6.93c-.04.34-.11.67-.19 1z"/></svg>
              <div>
                <span class="toggle-title">WebRTC Loopback</span>
                <span class="toggle-desc">Canli arama codec simulasyonu</span>
              </div>
            </div>
            <label class="toggle-switch loopback-switch">
              <input type="checkbox" id="loopbackToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- Opus Bitrate -->
          <div id="opusBitrateContainer" class="mode-container" data-setting="bitrate">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
              <span>Opus Bitrate (WebRTC)</span>
            </div>
            <div class="segment-control" id="bitrateSelector">
              <input type="radio" name="bitrate" id="bitrate32" value="32000">
              <label for="bitrate32" class="segment-btn">32 kbps</label>

              <input type="radio" name="bitrate" id="bitrate48" value="48000">
              <label for="bitrate48" class="segment-btn">48 kbps</label>

              <input type="radio" name="bitrate" id="bitrate64" value="64000" checked>
              <label for="bitrate64" class="segment-btn">64 kbps</label>

              <input type="radio" name="bitrate" id="bitrate96" value="96000">
              <label for="bitrate96" class="segment-btn">96 kbps</label>

              <input type="radio" name="bitrate" id="bitrate128" value="128000">
              <label for="bitrate128" class="segment-btn">128 kbps</label>
            </div>
          </div>

          <!-- MediaRecorder Bitrate (Sesli Mesaj icin) -->
          <div id="mediaBitrateContainer" class="mode-container" data-setting="mediaBitrate">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
              <span>Sesli Mesaj Bitrate</span>
            </div>
            <div class="segment-control" id="mediaBitrateSelector">
              <input type="radio" name="mediaBitrate" id="mediaBitrate0" value="0" checked>
              <label for="mediaBitrate0" class="segment-btn">Auto</label>

              <input type="radio" name="mediaBitrate" id="mediaBitrate16" value="16000">
              <label for="mediaBitrate16" class="segment-btn">16 kbps</label>

              <input type="radio" name="mediaBitrate" id="mediaBitrate24" value="24000">
              <label for="mediaBitrate24" class="segment-btn">24 kbps</label>

              <input type="radio" name="mediaBitrate" id="mediaBitrate32" value="32000">
              <label for="mediaBitrate32" class="segment-btn">32 kbps</label>
            </div>
          </div>
        </div>

        <!-- Gelistirici Ayarlari -->
        <div class="settings-section" id="developerSection">
          <div class="settings-section-title">Gelistirici</div>

          <!-- Timeslice -->
          <div class="mode-container" data-setting="timeslice">
            <div class="mode-label">
              <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
              <span>Timeslice Test</span>
            </div>
            <div class="segment-control timeslice-selector" id="timesliceSelector">
              <input type="radio" name="timeslice" id="tsOff" value="0" checked>
              <label for="tsOff" class="segment-btn">OFF</label>

              <input type="radio" name="timeslice" id="ts100" value="100">
              <label for="ts100" class="segment-btn">100ms</label>

              <input type="radio" name="timeslice" id="ts250" value="250">
              <label for="ts250" class="segment-btn">250ms</label>

              <input type="radio" name="timeslice" id="ts500" value="500">
              <label for="ts500" class="segment-btn">500ms</label>

              <input type="radio" name="timeslice" id="ts1000" value="1000">
              <label for="ts1000" class="segment-btn">1s</label>
            </div>
            <div class="timeslice-info" id="timesliceInfo">
              <span class="info-text">OFF: Tek chunk - timeslice yok</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="drawerOverlay" class="drawer-overlay"></div>

    <!-- Hidden profile selector for compatibility -->
    <select id="profileSelector" class="profile-dropdown" style="display: none;">
      <!-- Sesli Gorusme (call) -->
      <option value="discord" selected>Discord Voice</option>
      <option value="zoom">Zoom / Meet</option>
      <option value="whatsapp-call">WhatsApp Arama</option>
      <option value="telegram-call">Telegram Arama</option>
      <!-- Kayit (record) -->
      <option value="whatsapp-voice">WhatsApp Sesli Mesaj</option>
      <option value="telegram-voice">Telegram Sesli Mesaj</option>
      <option value="legacy">Eski Web Kayit</option>
      <option value="mictest">Ham Kayit</option>
    </select>

    <!-- Hidden scenario cards for compatibility -->
    <div id="scenarioCards" style="display: none;"></div>
    <div id="activeScenarioInfo" style="display: none;">
      <span id="scenarioBadge">Discord Voice</span>
      <span id="scenarioTech">WebRTC Loopback + Opus 64kbps</span>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
