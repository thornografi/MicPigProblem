<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mic Probe - Diagnose Microphone Issues</title>
  <meta name="description" content="Test your microphone with real-world simulations. WebRTC, codec testing, and voice app profiles for Discord, Zoom, WhatsApp, and more.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¤</text></svg>">
  <!-- Google Fonts: Bricolage Grotesque (landing display) + Rubik (app display) + Inter (UI) + JetBrains Mono (monospace) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700&family=Rubik:wght@500;600;700;800&family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/landing.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- SVG Gradient Definition (ayri, gorunur olmayan) -->
  <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" style="position:absolute">
    <defs>
      <!-- Brand icon gradient - sadece sol kisim (coral -> pink) - yazi ile birlesik gorunmesi icin -->
      <linearGradient id="brand-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#e85d3b"/>
        <stop offset="100%" stop-color="#d946a8"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- SVG Sprite (loaded from external file) -->
  <div id="svg-sprite-container"></div>
  <script>
    fetch('icons.svg')
      .then(r => r.text())
      .then(svg => document.getElementById('svg-sprite-container').innerHTML = svg);
  </script>

  <!-- ==================== LANDING VIEW ==================== -->
  <div id="landing-view">
    <!-- Navbar -->
    <nav class="navbar" id="navbar">
      <a href="#" class="navbar-brand">
        <svg class="navbar-logo" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-mic-brand"/></svg>
        <span class="navbar-title brand-wordmark"><span class="brand-word brand-word--mic">Mic</span><span class="brand-word brand-word--probe">Probe</span></span>
      </a>
      <div class="navbar-nav">
        <a href="#features" class="navbar-link">Features</a>
        <a href="#how-it-works" class="navbar-link">How It Works</a>
        <button class="navbar-cta" onclick="showAppView()">Get Started</button>
      </div>
      <button class="navbar-menu-btn" id="mobileMenuBtn" aria-label="Menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
        </svg>
      </button>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">
          <span class="hero-title-line">Diagnose Microphone Issues</span>
          <span class="hero-title-line">With</span>
          <span class="hero-title-line gradient-text">Real-World Simulations</span>
        </h1>

        <p class="hero-subtitle">
          Simulate voice calls and recordings from Discord, Zoom, WhatsApp, and more.
          Test WebRTC codecs, analyze audio quality, and identify problems before they happen.
        </p>

        <div class="hero-buttons">
          <button class="btn btn--primary" onclick="showAppView()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Get Started
          </button>
          <a href="#features" class="btn btn--secondary">
            Learn More
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Animated Microphone Visual -->
      <div class="hero-visual">
        <!-- Sound Wave Bars SVG - Statik dikey cubuklar (JS-driven) -->
        <svg class="hero-soundwave" viewBox="0 0 1600 260" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
          <defs>
            <!-- Bar gradient - yatay rainbow -->
            <linearGradient id="hero-bar-gradient" gradientUnits="userSpaceOnUse" x1="0" x2="1600">
              <stop offset="0%" stop-color="#f59e0b"/>
              <stop offset="15%" stop-color="#fb7185"/>
              <stop offset="35%" stop-color="#ec4899"/>
              <stop offset="50%" stop-color="#c026d3"/>
              <stop offset="65%" stop-color="#8b5cf6"/>
              <stop offset="80%" stop-color="#6366f1"/>
              <stop offset="100%" stop-color="#3b82f6"/>
            </linearGradient>
          </defs>
          <!-- Bars will be added by WaveAnimator.js -->
        </svg>
        <!-- Circular Ripples -->
        <div class="hero-waves">
          <div class="hero-wave"></div>
          <div class="hero-wave"></div>
          <div class="hero-wave"></div>
        </div>
        <div class="hero-mic-icon" onclick="showAppView()" title="Get Started"
             onmouseenter="document.querySelector('.hero-buttons .btn--primary').classList.add('mic-hover-active')"
             onmouseleave="document.querySelector('.hero-buttons .btn--primary').classList.remove('mic-hover-active')">
          <div class="hero-mic-circle">
            <svg viewBox="0 0 24 24" fill="currentColor"><use href="#icon-mic"/></svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="features">
      <div class="section-header">
        <span class="section-badge">Features</span>
        <h2 class="section-title">Everything You Need to Test Your Mic</h2>
        <p class="section-subtitle">Professional-grade tools to diagnose and analyze microphone issues across different platforms.</p>
      </div>

      <div class="features-grid">
        <!-- Feature 1: Voice Call Simulation -->
        <div class="feature-card">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 15.5c-1.25 0-2.45-.2-3.57-.57a1.02 1.02 0 00-1.02.24l-2.2 2.2a15.074 15.074 0 01-6.59-6.58l2.2-2.21c.28-.27.36-.66.25-1.01A11.36 11.36 0 018.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1z"/>
            </svg>
          </div>
          <h3 class="feature-title">Voice Call Simulation</h3>
          <p class="feature-description">
            Test your mic with real WebRTC loopback. Simulate Discord, Zoom, Google Meet, and Teams with authentic Opus codec settings.
          </p>
        </div>

        <!-- Feature 2: Voice Message Testing -->
        <div class="feature-card">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1 1.93c-3.94-.49-7-3.85-7-7.93h2c0 3.31 2.69 6 6 6s6-2.69 6-6h2c0 4.08-3.06 7.44-7 7.93V20h4v2H8v-2h4v-4.07z"/>
            </svg>
          </div>
          <h3 class="feature-title">Voice Message Testing</h3>
          <p class="feature-description">
            Record and playback with MediaRecorder. Test WhatsApp and Telegram voice message quality with configurable bitrates.
          </p>
        </div>

        <!-- Feature 3: Real-Time Monitoring -->
        <div class="feature-card">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
            </svg>
          </div>
          <h3 class="feature-title">Real-Time Monitoring</h3>
          <p class="feature-description">
            Live VU meters show input levels instantly. Dual meters for local and remote (codec-processed) audio comparison.
          </p>
        </div>

        <!-- Feature 4: Profile-Based Testing -->
        <div class="feature-card">
          <div class="feature-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
          </div>
          <h3 class="feature-title">Profile-Based Testing</h3>
          <p class="feature-description">
            Pre-configured profiles for popular apps. One click to match Discord, Zoom, WhatsApp, or Telegram audio settings.
          </p>
        </div>
      </div>
    </section>

    <!-- How It Works Section -->
    <section class="how-it-works" id="how-it-works">
      <div class="section-header">
        <span class="section-badge">How It Works</span>
        <h2 class="section-title">Three Simple Steps</h2>
        <p class="section-subtitle">Get started in seconds with our intuitive testing workflow.</p>
      </div>

      <div class="steps-container">
        <div class="step-card">
          <div class="step-number">1</div>
          <h3 class="step-title">Select a Profile</h3>
          <p class="step-description">
            Choose from Voice Calls (Discord, Zoom) or Voice Messages (WhatsApp, Telegram). Each profile mimics real app settings.
          </p>
        </div>

        <div class="step-card">
          <div class="step-number">2</div>
          <h3 class="step-title">Test Your Mic</h3>
          <p class="step-description">
            Use Monitor mode to hear yourself through the codec, or Record mode to capture and analyze your audio quality.
          </p>
        </div>

        <div class="step-card">
          <div class="step-number">3</div>
          <h3 class="step-title">Analyze Results</h3>
          <p class="step-description">
            Review VU meters, playback recordings, and check the console for detailed codec and audio processing information.
          </p>
        </div>
      </div>
    </section>

  </div>

  <!-- ==================== APP VIEW ==================== -->
  <div id="app-view" class="hidden">
    <div class="app-shell">
      <header class="app-header">
        <div class="app-header-content">
          <a href="#" class="brand-mark" onclick="showLandingView(); return false;" title="Back to Home">
            <svg class="brand-logo" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-mic-brand"/></svg>
            <span class="brand-title brand-wordmark"><span class="brand-word brand-word--mic">Mic</span><span class="brand-word brand-word--probe">Probe</span></span>
          </a>
        </div>
      </header>

      <div class="app-layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <!-- Voice Calls Category -->
          <div class="nav-section">
            <span class="nav-section-title">Voice Calls</span>
            <button class="nav-item nav-item-sub active" data-profile="discord">
              <svg><use href="#icon-discord"/></svg>
              <span>Discord</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="zoom">
              <svg><use href="#icon-zoom"/></svg>
              <span>Zoom / Meet / Teams</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="whatsapp-call">
              <svg><use href="#icon-whatsapp"/></svg>
              <span>WhatsApp Call</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="telegram-call">
              <svg><use href="#icon-telegram"/></svg>
              <span>Telegram Call</span>
            </button>
          </div>

          <!-- Voice Messages Category -->
          <div class="nav-section">
            <span class="nav-section-title">Voice Messages</span>
            <button class="nav-item nav-item-sub" data-profile="whatsapp-voice">
              <svg><use href="#icon-whatsapp"/></svg>
              <span>WhatsApp Voice</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="telegram-voice">
              <svg><use href="#icon-telegram"/></svg>
              <span>Telegram Voice</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="legacy">
              <svg><use href="#icon-legacy"/></svg>
              <span>Legacy Web</span>
            </button>
            <button class="nav-item nav-item-sub" data-profile="raw">
              <svg><use href="#icon-mic"/></svg>
              <span>Raw Recording</span>
            </button>
          </div>
        </nav>

      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <div class="content-container">
          <!-- Header -->
          <header class="page-header">
            <div class="header-left">
              <div class="header-title-row">
                <svg id="pageTitleIcon" class="page-title-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <use href="#icon-discord"/>
                </svg>
                <h1 id="pageTitle">Discord Voice Test</h1>
                <span id="statusBadge" class="status status-idle"><span class="status-dot"></span>Ready</span>
              </div>
              <p id="pageSubtitle">WebRTC Loopback + Opus 64kbps</p>
            </div>
          </header>

          <!-- Two Column Layout: Main + Info Sidebar -->
          <!-- Single Unified Panel -->
          <div class="panel panel-unified">
            <div class="panel-body unified-body">
              <!-- Row 1: Controls + Tips + Audio Status -->
              <div class="unified-row unified-row-main">
                <!-- Controls Section -->
                <div class="unified-section unified-controls">
                  <div class="mic-selector-row">
                    <select id="micSelector" class="mic-dropdown">
                      <option value="">Default microphone</option>
                    </select>
                    <button id="refreshMics" class="btn-icon" title="Refresh microphone list">
                      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                  </div>

                  <div class="button-row">
                    <button id="recordToggle" class="btn btn-action btn-record">
                      <svg class="icon-circle" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"/></svg>
                      <svg class="icon-square" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                      <span class="btn-text">Record</span>
                    </button>
                    <button id="monitorToggle" class="btn btn-action btn-monitor">
                      <svg class="icon-play" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
                      <svg class="icon-stop" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                      <span class="btn-text">Monitor</span>
                    </button>
                  </div>

                  <div id="recordingTimer" class="recording-timer">0:00</div>
                  <div id="preparingOverlay" class="preparing-overlay">
                    <span class="preparing-spinner"></span>
                    <span class="preparing-text">Preparing...</span>
                  </div>
                </div>

                <!-- Tips (inline text, no boxes) -->
                <div class="unified-tips">
                  <span class="utip"><em>1</em><span class="utip-text">Click <strong>Monitor</strong> to hear yourself</span></span>
                  <span class="utip"><em>2</em><span class="utip-text">Watch the VU meters for levels</span></span>
                  <span class="utip"><em>3</em><span class="utip-text">Use <strong>Record</strong> to capture</span></span>
                </div>

                <!-- Audio Status -->
                <div id="deviceInfoPanel" class="unified-status">
                  <div class="stat"><span class="stat-l">Mic</span><span id="infoMicName" class="stat-v">--</span></div>
                  <div class="stat"><span class="stat-l">Ch</span><span id="infoChannels" class="stat-v">--</span></div>
                  <div class="stat"><span class="stat-l">Target</span><span id="infoTargetBitrate" class="stat-v">--</span></div>
                  <div class="stat"><span class="stat-l">Actual</span><span id="infoActualBitrate" class="stat-v">--</span></div>
                </div>
              </div>

              <!-- Row 2: VU Meters -->
              <div class="unified-row unified-row-vu">
                <div class="vu-section">
                  <div class="vu-label">
                    <span id="signalDot" class="signal-dot"></span>
                    <span>Local (Microphone)</span>
                  </div>
                  <div class="vu-meter">
                    <div id="vuMeterBar" class="vu-meter-bar"></div>
                    <div id="vuMeterPeak" class="vu-meter-peak"></div>
                  </div>
                </div>
                <div id="remoteVuContainer" class="vu-section">
                  <div class="vu-label">
                    <span class="signal-dot remote-dot"></span>
                    <span>Remote (After Codec)</span>
                  </div>
                  <div class="vu-meter">
                    <div id="remoteVuBar" class="vu-meter-bar remote-bar"></div>
                    <div id="remoteVuPeak" class="vu-meter-peak"></div>
                  </div>
                </div>
              </div>

              <!-- Row 3: Player -->
              <div class="unified-row unified-row-player">
                <div id="recordingPlayer" class="recording-player">
                  <div class="player-controls">
                    <button id="playBtn" class="btn-play">
                      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <div class="player-info">
                      <div id="playerFilename" class="player-filename">No recording</div>
                      <div id="playerMeta" class="player-meta">-</div>
                    </div>
                  </div>
                  <div class="player-progress-row">
                    <div class="progress-bar" id="progressBar">
                      <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="playerTime" class="player-time">0:00 / 0:00</div>
                  </div>
                  <div class="player-actions">
                    <a id="downloadBtn" class="btn-download" href="#" download>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                      Download
                    </a>
                  </div>
                </div>
                <p id="noRecording" class="empty-state" style="display: none;">No recording yet</p>
              </div>

              <!-- Row 4: Custom Settings (Collapsible) -->
              <div class="unified-row unified-row-settings" id="customSettingsPanel">
                <div class="custom-settings-toggle" id="customSettingsToggle">
                  <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                  <span>Custom Settings</span>
                  <svg class="toggle-chevron" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M7 10l5 5 5-5z"/></svg>
                </div>
                <div class="custom-settings-content collapsed" id="customSettingsContent">
                  <div class="custom-settings-grid" id="customSettingsGrid">
                    <!-- Dynamic content via JS -->
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </main>
    </div>


      <!-- Dev Console Slide Panel (from right) -->
      <div class="dev-console-drawer" id="devConsole">
        <div class="dev-console-drawer-header">
          <div class="drawer-title">
            <svg class="toggle-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/></svg>
            <span>Console</span>
            <span class="log-count" id="logCount">0</span>
          </div>
          <div class="header-actions">
            <button class="btn-copy" id="copyLogsBtn" onclick="copyAllLogs()" title="Copy all logs">
              <svg class="icon-copy" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <svg class="icon-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </button>
            <button class="btn-clear" onclick="clearLog()">Clear</button>
            <button class="btn-close-console" onclick="toggleDevConsole()" title="Close Console">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
          </div>
        </div>
        <div class="dev-console-drawer-body">
          <pre id="log"></pre>
        </div>
        <div class="dev-console-drawer-footer">
          <div class="filter-buttons">
            <button class="btn-filter active" data-category="all" onclick="filterLogs('all')">All</button>
            <button class="btn-filter btn-filter-error" data-category="error" onclick="filterLogs('error')">Errors</button>
            <button class="btn-filter" data-category="webaudio" onclick="filterLogs('webaudio')">WebAudio</button>
            <button class="btn-filter" data-category="stream" onclick="filterLogs('stream')">Stream</button>
            <button class="btn-filter" data-category="recorder" onclick="filterLogs('recorder')">Recorder</button>
          </div>
          <div class="export-buttons">
            <button class="btn-export-small" onclick="exportLogs()" title="Export logs as JSON">Export</button>
            <button class="btn-export-small" onclick="getLogStats()" title="Log statistics">Stats</button>
            <button class="btn-export-small" onclick="runSanityChecks()" title="Log sanity check">Sanity</button>
          </div>
        </div>
      </div>

      <!-- Console Toggle Button (Fixed at right edge) -->
      <button class="dev-console-toggle-btn" id="devConsoleToggle" onclick="toggleDevConsole()" title="Toggle Developer Console">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/></svg>
      </button>

      <!-- Settings Drawer -->
      <div id="settingsDrawer" class="settings-drawer">
        <div class="drawer-header">
          <h3>Advanced Settings</h3>
          <button class="btn-close-drawer" id="closeDrawer">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </div>
        <div class="drawer-body">
          <!-- Audio Processing -->
          <div class="settings-section">
            <div class="settings-section-title">Audio Processing</div>
            <div class="settings-grid">
              <label class="setting-item">
                <input id="ec" type="checkbox" checked>
                <span class="setting-label">Echo Cancellation</span>
              </label>
              <label class="setting-item">
                <input id="ns" type="checkbox" checked>
                <span class="setting-label">Noise Suppression</span>
              </label>
              <label class="setting-item">
                <input id="agc" type="checkbox" checked>
                <span class="setting-label">Auto Gain Control</span>
              </label>
            </div>

            <!-- Sample Rate -->
            <div id="sampleRateContainer" class="mode-container" data-setting="sampleRate">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                <span>Sample Rate</span>
              </div>
              <div class="segment-control" id="sampleRateSelector">
                <input type="radio" name="sampleRate" id="sr16" value="16000">
                <label for="sr16" class="segment-btn">16 kHz</label>
                <input type="radio" name="sampleRate" id="sr22" value="22050">
                <label for="sr22" class="segment-btn">22 kHz</label>
                <input type="radio" name="sampleRate" id="sr44" value="44100">
                <label for="sr44" class="segment-btn">44.1 kHz</label>
                <input type="radio" name="sampleRate" id="sr48" value="48000" checked>
                <label for="sr48" class="segment-btn">48 kHz</label>
              </div>
            </div>

            <!-- Channel Count -->
            <div id="channelCountContainer" class="mode-container" data-setting="channelCount">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.76 16.24l-1.41 1.41C4.78 16.1 4 14.05 4 12c0-2.05.78-4.1 2.34-5.66l1.41 1.41C6.59 8.93 6 10.46 6 12s.59 3.07 1.76 4.24zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm5.66 1.66l-1.41-1.41C17.41 15.07 18 13.54 18 12s-.59-3.07-1.76-4.24l1.41-1.41C19.22 7.9 20 9.95 20 12c0 2.05-.78 4.1-2.34 5.66z"/></svg>
                <span>Channel Count</span>
              </div>
              <div class="segment-control" id="channelCountSelector">
                <input type="radio" name="channelCount" id="ch1" value="1" checked>
                <label for="ch1" class="segment-btn">Mono</label>
                <input type="radio" name="channelCount" id="ch2" value="2">
                <label for="ch2" class="segment-btn">Stereo</label>
              </div>
            </div>
          </div>

          <!-- Pipeline Settings -->
          <div class="settings-section" id="pipelineSection">
            <div class="settings-section-title">Pipeline</div>

            <!-- Pipeline Selector -->
            <div id="pipelineContainer" class="mode-container" data-setting="pipeline">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                <span>Pipeline</span>
              </div>
              <div class="segment-control" id="pipelineSelector">
                <input type="radio" name="pipeline" id="pipelineDirect" value="direct">
                <label for="pipelineDirect" class="segment-btn">Direct</label>
                <input type="radio" name="pipeline" id="pipelineStandard" value="standard" checked>
                <label for="pipelineStandard" class="segment-btn">Standard</label>
                <input type="radio" name="pipeline" id="pipelineScript" value="scriptprocessor">
                <label for="pipelineScript" class="segment-btn">ScriptProcessor</label>
                <input type="radio" name="pipeline" id="pipelineWorklet" value="worklet">
                <label for="pipelineWorklet" class="segment-btn">Worklet</label>
              </div>
            </div>

            <!-- Encoder Selector -->
            <div id="encoderContainer" class="mode-container" data-setting="encoder">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                <span>Encoder</span>
              </div>
              <div class="segment-control" id="encoderSelector">
                <input type="radio" name="encoder" id="encoderMediaRecorder" value="mediarecorder" checked>
                <label for="encoderMediaRecorder" class="segment-btn">MediaRecorder</label>
                <input type="radio" name="encoder" id="encoderWasmOpus" value="wasm-opus" data-requires-wasm="true">
                <label for="encoderWasmOpus" class="segment-btn">WASM Opus</label>
              </div>
            </div>

            <!-- Buffer Size -->
            <div id="bufferSizeContainer" class="mode-container" data-setting="buffer">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/></svg>
                <span>Buffer Size</span>
              </div>
              <div class="segment-control" id="bufferSizeSelector">
                <input type="radio" name="bufferSize" id="buffer1024" value="1024">
                <label for="buffer1024" class="segment-btn">1024</label>
                <input type="radio" name="bufferSize" id="buffer2048" value="2048">
                <label for="buffer2048" class="segment-btn">2048</label>
                <input type="radio" name="bufferSize" id="buffer4096" value="4096" checked>
                <label for="buffer4096" class="segment-btn">4096</label>
              </div>
              <div class="buffer-info">
                <span class="info-text" id="bufferInfoText">4096 samples @ 48kHz = ~85ms latency</span>
              </div>
            </div>
          </div>

          <!-- WebRTC Settings -->
          <div class="settings-section" id="webrtcSection">
            <div class="settings-section-title">WebRTC Simulation</div>

            <div class="loopback-toggle-container" data-setting="loopback">
              <div class="toggle-info">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c1.03.13 2 .45 2.87.93H13v-.93zM13 7h5.24c.25.31.48.65.68 1H13V7zm0 3h6.74c.08.33.15.66.19 1H13v-1zm0 9.93V19h2.87c-.87.48-1.84.8-2.87.93zM18.24 17H13v-1h5.92c-.2.35-.43.69-.68 1zm1.5-3H13v-1h6.93c-.04.34-.11.67-.19 1z"/></svg>
                <div>
                  <span class="toggle-title">WebRTC Loopback</span>
                  <span class="toggle-desc">Live call codec simulation</span>
                </div>
              </div>
              <label class="toggle-switch loopback-switch">
                <input type="checkbox" id="loopbackToggle">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div id="opusBitrateContainer" class="mode-container" data-setting="bitrate">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                <span>Opus Bitrate (WebRTC)</span>
              </div>
              <div class="segment-control" id="bitrateSelector">
                <input type="radio" name="bitrate" id="bitrate32" value="32000">
                <label for="bitrate32" class="segment-btn">32 kbps</label>
                <input type="radio" name="bitrate" id="bitrate48" value="48000">
                <label for="bitrate48" class="segment-btn">48 kbps</label>
                <input type="radio" name="bitrate" id="bitrate64" value="64000" checked>
                <label for="bitrate64" class="segment-btn">64 kbps</label>
                <input type="radio" name="bitrate" id="bitrate96" value="96000">
                <label for="bitrate96" class="segment-btn">96 kbps</label>
                <input type="radio" name="bitrate" id="bitrate128" value="128000">
                <label for="bitrate128" class="segment-btn">128 kbps</label>
              </div>
            </div>

            <div id="mediaBitrateContainer" class="mode-container" data-setting="mediaBitrate">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                <span>Voice Message Bitrate</span>
              </div>
              <div class="segment-control" id="mediaBitrateSelector">
                <input type="radio" name="mediaBitrate" id="mediaBitrate0" value="0" checked>
                <label for="mediaBitrate0" class="segment-btn">Auto</label>
                <input type="radio" name="mediaBitrate" id="mediaBitrate16" value="16000">
                <label for="mediaBitrate16" class="segment-btn">16 kbps</label>
                <input type="radio" name="mediaBitrate" id="mediaBitrate24" value="24000">
                <label for="mediaBitrate24" class="segment-btn">24 kbps</label>
                <input type="radio" name="mediaBitrate" id="mediaBitrate32" value="32000">
                <label for="mediaBitrate32" class="segment-btn">32 kbps</label>
              </div>
            </div>
          </div>

          <!-- Developer Settings -->
          <div class="settings-section" id="developerSection">
            <div class="settings-section-title">Developer</div>

            <div class="mode-container" data-setting="timeslice">
              <div class="mode-label">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                <span>Timeslice Test</span>
              </div>
              <div class="segment-control timeslice-selector" id="timesliceSelector">
                <input type="radio" name="timeslice" id="tsOff" value="0" checked>
                <label for="tsOff" class="segment-btn">OFF</label>
                <input type="radio" name="timeslice" id="ts100" value="100">
                <label for="ts100" class="segment-btn">100ms</label>
                <input type="radio" name="timeslice" id="ts250" value="250">
                <label for="ts250" class="segment-btn">250ms</label>
                <input type="radio" name="timeslice" id="ts500" value="500">
                <label for="ts500" class="segment-btn">500ms</label>
                <input type="radio" name="timeslice" id="ts1000" value="1000">
                <label for="ts1000" class="segment-btn">1s</label>
              </div>
              <div class="timeslice-info" id="timesliceInfo">
                <span class="info-text">OFF: Single chunk - no timeslice</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="drawerOverlay" class="drawer-overlay"></div>

      <!-- Hidden profile selector for compatibility -->
      <select id="profileSelector" class="profile-dropdown" style="display: none;">
        <option value="discord" selected>Discord Voice</option>
        <option value="zoom">Zoom / Meet</option>
        <option value="whatsapp-call">WhatsApp Call</option>
        <option value="telegram-call">Telegram Call</option>
        <option value="whatsapp-voice">WhatsApp Voice</option>
        <option value="telegram-voice">Telegram Voice</option>
        <option value="legacy">Legacy Web</option>
        <option value="raw">Raw Recording</option>
      </select>

      <div id="scenarioCards" style="display: none;"></div>
      <div id="activeScenarioInfo" style="display: none;">
        <span id="scenarioBadge">Discord Voice</span>
        <span id="scenarioTech">WebRTC Loopback + Opus 64kbps</span>
      </div>
    </div>
  </div>

  <!-- ==================== SHARED FOOTER ==================== -->
  <footer class="site-footer" id="sharedFooter">
    <div class="site-footer-content">
      <a href="#" class="site-footer-brand" onclick="showLandingView(); return false;">
        <svg viewBox="0 0 24 24" fill="currentColor"><use href="#icon-mic-brand"/></svg>
        <span class="brand-wordmark"><span class="brand-word brand-word--mic">Mic</span><span class="brand-word brand-word--probe">Probe</span></span>
      </a>
      <nav class="site-footer-links">
        <a href="#features" onclick="showLandingView();">Features</a>
        <a href="#how-it-works" onclick="showLandingView();">How It Works</a>
      </nav>
      <p class="site-footer-meta">Built for developers and audio enthusiasts</p>
    </div>
  </footer>

  <!-- View Manager Script -->
  <script>
    // View switching with hash routing
    function showAppView() {
      document.body.classList.add('app-mode');
      document.getElementById('landing-view').classList.add('hidden');
      document.getElementById('app-view').classList.remove('hidden');
      window.scrollTo(0, 0);

      // Update URL hash
      if (window.location.hash !== '#app') {
        history.pushState(null, '', '#app');
      }

      // Initialize app if not already done
      if (window.initializeApp && !window.appInitialized) {
        window.initializeApp();
        window.appInitialized = true;
      }
    }

    function showLandingView() {
      document.body.classList.remove('app-mode');
      document.getElementById('app-view').classList.add('hidden');
      document.getElementById('landing-view').classList.remove('hidden');
      window.scrollTo(0, 0);

      // Update URL hash
      if (window.location.hash !== '') {
        history.pushState(null, '', window.location.pathname);
      }
    }

    // Handle initial load and hash changes
    function handleRoute() {
      if (window.location.hash === '#app') {
        showAppView();
      } else {
        showLandingView();
      }
    }

    // Listen for hash changes (browser back/forward)
    window.addEventListener('hashchange', handleRoute);

    // Handle initial page load
    window.addEventListener('DOMContentLoaded', handleRoute);

    // Navbar scroll effect
    window.addEventListener('scroll', () => {
      const navbar = document.getElementById('navbar');
      if (navbar && window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else if (navbar) {
        navbar.classList.remove('scrolled');
      }
    });

    // Smooth scroll for anchor links (except #app)
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        const href = this.getAttribute('href');
        if (href !== '#' && href !== '#app') {
          e.preventDefault();
          const target = document.querySelector(href);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });
    });

    // Dev Console toggle
    function toggleDevConsole() {
      const devConsole = document.getElementById('devConsole');
      devConsole.classList.toggle('open');
    }

    // Update log count (called from Logger module)
    window.updateLogCount = function(count) {
      const countEl = document.getElementById('logCount');
      if (countEl) {
        countEl.textContent = count > 99 ? '99+' : count;
        countEl.classList.toggle('has-logs', count > 0);
      }
    };
  </script>

  <!-- Wave Animator (Landing Page) -->
  <script type="module">
    import { initWaveAnimator } from './js/modules/WaveAnimator.js';

    // Initialize wave animation on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      initWaveAnimator('.hero-soundwave', {
        // Bar sayisi - ekrani kaplamak icin
        barCount: 280,

        // ViewBox dimensions
        width: 1600,
        height: 260,

        // Cubuk boyutlari
        barWidth: 2.5,
        barGap: 3,
        minBarHeight: 6,
        maxBarHeight: 180, // %20 daha yuksek

        // Wave frekans (dogal ses sinyali icin)
        waveFrequency: 1.8,
        secondaryFrequency: 4.3,
        tertiaryFrequency: 7.1,
        quaternaryFrequency: 11.7, // 4. harmonic

        // Merkez bosluk (mikrofon ikonu)
        centerGap: 0.10,
        centerFadeZone: 0.06,

        // Kenar fade - yavas gecis
        edgeFadeStart: 0.35,
        edgeFadeEnd: 0.05,

        // Merkez dugum efekti - kenarlarda yuksek, merkeze dogru azalan
        centerHeightMin: 0.15,   // Merkezde yukseklik %15'e duser
        centerHeightEasing: 0.5
      });
    });
  </script>

  <!-- App Script -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
